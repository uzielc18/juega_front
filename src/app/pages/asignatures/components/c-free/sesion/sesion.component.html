<nb-card class="mb-2 cardd" [nbSpinner]="loading" nbSpinnerStatus="primary" nbSpinnerSize="large" nbSpinnerMessage="Procesando información">
  <nb-card-body class="p-0">
    <div class="ps-0">
      <div class="d-flex align-items-center" style="overflow: hidden; position: relative; width: 100%">
        <div
          class="d-flex flex-column align-items-center justify-content-center rounded-start fecha"
          [ngStyle]="{'background-color': unidad.active == 1 && sesion.active == 1? 'var(--color-primary-600)': 'var(--color-primary-50)', 'color': unidad.active == 1 && sesion.active == 1? '#FFFFFF': ''}"
        >
          <span class="fw-bold" style="font-size: 24px">{{ sesion?.fecha_tema | date: 'dd' }}</span
          ><small style="font-size: 14px; color: #898989">{{ sesion?.fecha_tema | date: 'MMM' | titlecase }}</small>
        </div>
        <div style="width: 100%; margin-left: 80px">
          <div class="d-flex justify-content-between align-items-center my-3">
            <div class="d-flex flex-column ps-3">
              <small class="fw-bold"> {{ unidad?.orden_unidad }}.{{ sesion?.orden_tema }}- {{ sesion?.contenido !== null? sesion?.contenido: sesion?.tema }} </small>
            </div>
          </div>
          <hr class="mb-0" style="color: #898989" />
          <div class="list-elements">
            <div class="d-flex align-items-center flex-wrap">

              <div class="d-flex flex-wrap" *ngIf="sesion?.modo === 'agrupado'">
                <div
                  *ngFor="let elem of sesion?.elements; let i = index"
                  class="d-flex flex-column align-items-center"
                  [ngClass]="{
                    'p-3': ['Docente', 'Admin'].includes(rolSemestre?.rol?.name),
                    'py-2 px-3': rolSemestre?.rol?.name === 'Estudiante'
                  }"
                  (mouseenter)="hoveredIndex = i"
                  (mouseleave)="hoveredIndex = null"
                  [ngStyle]="
                    clickedIndex === elem.check
                      ? elementStyleActive(elem)
                      : elementStyle() && hoveredIndex === i
                      ? elementStyleHover(elem)
                      : elementStyle()
                  "
                  (click)="selectedElement(elem)"
                  style="cursor: pointer"
                >
                  <small style="font-size: 10px" *ngIf="rolSemestre?.rol?.name === 'Estudiante'">
                    {{ elem?.realizo }}-{{arrayEl?.length > 0 && elem?.type_element_id === arrayEl[0]?.type_element_id ? arrayEl?.length : elem?.count}}</small>
                  <nb-icon [icon]="elem?.icono"></nb-icon>
                  <small class="element-nombre">{{ elem?.nombre }}</small>
                </div>
              </div>

              <div class="d-flex flex-wrap" *ngIf="sesion?.modo === 'ordenado'">
                &nbsp;&nbsp;&nbsp;
                <button nbButton size="tiny"
                status="success" outline  (click)="selectedElemenstOrden(sesion)">
                <nb-icon [icon]="'eye'"></nb-icon>Ver</button>
                &nbsp;&nbsp;
                <button nbButton size="tiny" *ngIf="['Docente', 'Admin'].includes(rolSemestre?.rol?.name) && arrayEl?.length>0"
                status="primary" outline (click)="openElementosOrden()">
                <nb-icon [icon]="'edit'"></nb-icon>Órden</button>
                <span *ngIf="arrayEl[0]?.orden === null && arrayEl?.length>0" class="orden">Guardar orden*</span>
              </div>

              <div class="d-flex align-items-center p-0 ms-auto me-3 my-3" *ngIf="['Docente', 'Admin'].includes(rolSemestre?.rol?.name)">
                <!-- <nb-button-group> -->
                  <button nbButton size="small"
                  status="warning"
                  [nbTooltip]="sesion?.modo === 'ordenado' ? 'Modo ordenado' : sesion?.modo === 'agrupado' ? 'Modo agrupado' : 'No tiene modo asignado'"
                  nbTooltipPlacement="top"
                  nbTooltipStatus="warning"
                  (click)="openModo(sesion)">
                  <nb-icon *ngIf="sesion?.modo" [icon]="sesion?.modo === 'ordenado' ? 'list-outline' : sesion?.modo === 'agrupado' ? 'grid-outline' : ''"></nb-icon>Modo</button>&nbsp;&nbsp;
                  <button
                    (click)="newElemnts()"
                    status="primary"
                    nbButton
                    size="small"
                    class="shadow-sm border-0"
                    nbTooltip="Crear elementos"
                    nbTooltipPlacement="top"
                    nbTooltipStatus="primary"
                  >
                    <nb-icon icon="plus"class="fs-4"></nb-icon>
                  </button>
                <!-- </nb-button-group> -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nb-card-body>
</nb-card>
  <nb-card *ngIf="arrayEl?.length > 0" class="list-element">
    <nb-list>
      <nb-list-item *ngFor="let el of arrayEl; let i = index" class="d-flex align-items-center justify-content-between">
        <div>
          <h5 class="sesion-title">{{ sesion?.modo === 'ordenado' ? el.orden : (i +1) }}. <nb-icon [icon]="el.icon"></nb-icon> {{ el.titulo }} - <small class="label" style="font-size: 10px" *ngIf="el.visibilidad === '0' && rolSemestre?.rol?.name !== 'Estudiante'">(Oculto para el estudiante)</small><nb-icon icon="eye-off-outline" *ngIf="el.visibilidad === '0' && rolSemestre?.rol?.name !== 'Estudiante'"></nb-icon></h5>
          <p class="label sesion-description"  *ngIf="['EVALUACION', 'TRABAJO', 'FORO'].includes(el?.tipo)">{{el.fecha_inicio | date: 'MMMM d, y, h:mm:ss a' | titlecase}} / {{el.fecha_fin | date: 'MMMM d, y, h:mm:ss a' | titlecase}}</p>
          <p class="sesion-description">
            {{ el.descripcion }}
          </p>
          <label class="label" *ngIf="['Docente', 'Admin'].includes(rolSemestre?.rol?.name)">
            <button *ngIf="['FORO', 'TRABAJO'].includes(el?.tipo)" nbButton size="tiny" outline status="basic" ghost class="butonsInfo" (click)="openCalificarElement(el)">
              Sin Calificar: {{ el?.total_entregados - el?.total_revisados }}</button
            >&nbsp;
            <button *ngIf="['FORO', 'TRABAJO'].includes(el?.tipo)" nbButton size="tiny" outline status="success" ghost class="butonsInfo" (click)="openCalificarElement(el)">
              Calificados: {{ el?.total_revisados }}</button
            >&nbsp;
            <button *ngIf="['FORO', 'TRABAJO'].includes(el?.tipo)" nbButton size="tiny" outline status="danger" ghost class="butonsInfo" (click)="openCalificarElement(el)">
              Sin entregar: {{ el?.total_pendientes - el?.total_entregados }}</button
            >&nbsp;
            <button nbButton size="tiny" outline status="warning" ghost class="butonsInfo" (click)="openCalificarElement(el)">Total vistos: {{ el?.total_vistos }}</button>&nbsp;
            <button nbButton size="tiny" outline status="info" ghost class="butonsInfo" (click)="openCalificarElement(el)">
              Total alumnos: {{ el?.course?.total_matriculados }}
            </button>
          </label>
        </div>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <div>
          <div class="d-flex align-items-center">

            <!-- <nb-button-group class="d-flex align-items-center flex-wrap flex-md-nowrap p-0" style="gap: 5px">nbsp;-->

              <button
                *ngIf="['Docente', 'Admin'].includes(rolSemestre?.rol?.name) && el?.grupal === '1'"
                nbButton
                status="primary"
                size="small"
                nbTooltip="Administrar grupos"
                nbTooltipPlacement="top"
                nbTooltipStatus="primary"
                (click)="adminGrupal(el)"
              >
                <nb-icon icon="people-outline"></nb-icon>
              </button>&nbsp;
              <button
                *ngIf="['Docente', 'Admin'].includes(rolSemestre?.rol?.name) && el?.tipo === 'EVALUACION'"
                nbButton
                status="info"
                size="small"
                nbTooltip="Gestionar preguntas"
                nbTooltipPlacement="top"
                nbTooltipStatus="info"
                (click)="openQuestionConfig(el)"
              >
                <nb-icon icon="question-mark-outline"></nb-icon>
              </button>&nbsp;
              <button
                style="margin: 0 5px;"
                *ngIf="['Docente', 'Admin'].includes(rolSemestre?.rol?.name)"
                nbButton
                status="warning"
                size="small"
                nbTooltip="Duplicar o mover elemento"
                nbTooltipPlacement="top"
                nbTooltipStatus="warning"
                (click)="openCopyAndMoveElement(el)"
              >
                <nb-icon icon="copy"></nb-icon>
              </button>
              <button
                *ngIf="['Docente', 'Admin'].includes(rolSemestre?.rol?.name)"
                nbButton
                status="info"
                size="small"
                nbTooltip="Editar"
                nbTooltipPlacement="top"
                nbTooltipStatus="info"
                (click)="updateElements(el)"
              >
                <nb-icon icon="edit-2-outline"></nb-icon>
              </button>&nbsp;
              <button
                *ngIf="['Docente', 'Admin'].includes(rolSemestre?.rol?.name) && ((el.total_entregados === 0 && el.tipo === 'EVALUACION') || el.tipo !== 'EVALUACION')"
                nbButton
                status="danger"
                size="small"
                nbTooltip="Eliminar"
                nbTooltipPlacement="top"
                nbTooltipStatus="danger"
                (click)="deleteElements(el)"
              >
                <nb-icon icon="trash-2-outline"></nb-icon>
              </button>
            <nb-icon icon="checkmark-outline" *ngIf="el?.pendings?.fecha_visto===null && el?.pendings?.fecha_entrega===null "></nb-icon>
            <nb-icon icon="done-all-outline" *ngIf="el?.pendings?.fecha_visto!==null && el?.pendings?.fecha_entrega===null "></nb-icon>
            <nb-icon icon="done-all-outline" [style]="'color:green;'" *ngIf="el?.pendings?.fecha_visto && el?.pendings?.fecha_entrega"></nb-icon>

              <button
                nbButton
                status="success"
                size="small"
                [outline]="el?.pendings?.fecha_visto  ? true : false"
                nbTooltip="Ver"
                nbTooltipPlacement="top"
                nbTooltipStatus="success"
                (click)="navigate(el)"
                [disabled]="(rolSemestre?.rol?.name === 'Estudiante' && el?.listo === 0 && sesion?.modo === 'ordenado')">
                <nb-icon icon="eye-outline"></nb-icon>
              </button>
            <!-- </nb-button-group> -->
          </div>
        </div>
      </nb-list-item>
    </nb-list>
  </nb-card>
