<nb-card class="m-0 h-100 border-0" style="border-radius: 15px" [nbSpinner]="loading" nbSpinnerStatus="primary"
    nbSpinnerSize="small">
    <nb-card-header>
        <div class="d-flex">
            <nb-icon icon="plus-outline" status="primary" style="font-size: 40px"></nb-icon>&nbsp;&nbsp;
            <strong style="padding-top: 7px">CREAR NOTICIAS</strong>
        </div>
    </nb-card-header>
    <nb-card-body>
        <div class="row">
            <div class="col-md-5">
                <nb-card status="primary">
                    <nb-card-header style="padding-top: 5px; padding-bottom: 5px;">
                        INFORMACIÓN
                    </nb-card-header>
                    <div class="card-body">
                        <form [formGroup]="formHeader">
                            <div class="row">
                                <label class="label col-md-3">Título:</label>
                                <div class="col-md-9">
                                    <input type="text" maxlength="100" placeholder="Ingrese título" nbInput fullWidth fieldSize="small" formControlName="titulo"
                                        >
                                    <control-messages [control]="formHeader.get('titulo')"></control-messages>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <label class="label col-md-3">Tipo público:</label>
                                <div class="col-md-9">
                                    <nb-select  placeholder="Seleccione" fullWidth fieldSize="small" formControlName="tipo_filtro"
                                    (selectedChange)="changeType($event)">
                                        <nb-option value="area">Área</nb-option>
                                        <nb-option value="edad">Edad</nb-option>
                                    </nb-select>
                                    <control-messages [control]="formHeader.get('tipo_filtro')"></control-messages>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <label class="label col-md-3">Opciones:</label>
                                <div class="col-md-9">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <nb-toggle formControlName="publicar">Publicar</nb-toggle>
                                            <control-messages [control]="formHeader.get('publicar')"></control-messages>
                                        </div>
                                        <div class="col-md-6" *ngIf="formHeader.value.tipo_filtro === 'area'">
                                            <nb-toggle formControlName="todos" (checkedChange)="changeTodos($event)">Todos</nb-toggle>
                                            <control-messages [control]="formHeader.get('todos')"></control-messages>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <br *ngIf="formHeader.value.tipo_filtro === 'area' && !formHeader.value.todos">
                            <div class="row" *ngIf="formHeader.value.tipo_filtro === 'area' && !formHeader.value.todos ">
                                <label class="label col-md-3">Área:</label>
                                <div class="col-md-9">
                                    <ngx-dropdown-treeview [config]="config" [items]="emploreAreas" [buttonClass]="buttonClass"
                                    (selectedChange)="onSelectedChange($event)">
                                    </ngx-dropdown-treeview>

                                    <control-messages [control]="formHeader.get('area')"></control-messages>
                                </div>
                            </div>
                            <br  *ngIf="formHeader.value.tipo_filtro === 'edad'">
                            <div class="row"  *ngIf="formHeader.value.tipo_filtro === 'edad'">
                                <label class="label col-md-3">Edad rángo:</label>
                                <div class="col-md-9">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <input type="number" placeholder="Desde" nbInput fullWidth fieldSize="small"
                                                    formControlName="edad_desde">
                                                <control-messages [control]="formHeader.get('edad_desde')">
                                                </control-messages>
                                        </div>
                                        <div class="col-md-6">
                                                <input type="number" placeholder="Hasta" nbInput fullWidth fieldSize="small"
                                                    formControlName="edad_hasta">
                                                <control-messages [control]="formHeader.get('edad_hasta')">
                                                </control-messages>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <label class="label col-md-3">Fechas:</label>
                                <div class="col-md-9">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <nb-form-field>
                                                <input type="text" nbInput placeholder="Fecha Inicio" fullWidth
                                                    [nbDatepicker]="fechaInicio" fieldSize="small" formControlName="fecha_inicio"/>
                                                <nb-icon nbSuffix icon="calendar" status="primary" size="small"
                                                    pack="eva"></nb-icon>
                                                <nb-datepicker #fechaInicio format="dd/MM/yyyy" [min]="min">
                                                </nb-datepicker>
                                                <control-messages [control]="formHeader.get('fecha_inicio')">
                                                </control-messages>
                                            </nb-form-field>
                                        </div>
                                        <div class="col-md-6">
                                            <fieldset [disabled]="!formHeader.value.fecha_inicio">
                                            <nb-form-field>
                                                <input type="text" nbInput placeholder="Fecha fin" fullWidth
                                                    [nbDatepicker]="fechaFin" fieldSize="small" formControlName="fecha_fin"/>
                                                <nb-icon nbSuffix icon="calendar" status="primary" size="small"
                                                    pack="eva"></nb-icon>
                                                <nb-datepicker #fechaFin format="dd/MM/yyyy" [min]="formHeader.value.fecha_inicio">
                                                </nb-datepicker>
                                                <control-messages [control]="formHeader.get('fecha_fin')">
                                                </control-messages>
                                            </nb-form-field>
                                        </fieldset>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <label class="label col-md-3">Mostrar botón:</label>
                                <div class="col-md-9">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <nb-toggle formControlName="mostrar_boton" (checkedChange)="changeMBoton($event)"></nb-toggle>
                                            <control-messages [control]="formHeader.get('mostrar_boton')">
                                            </control-messages>
                                        </div>
                                        <div class="col-md-6">
                                                <input type="text" placeholder="Ingrese nombre del botón" nbInput fullWidth fieldSize="small"
                                                    formControlName="nombre_boton" [readOnly]="!formHeader.value.mostrar_boton">
                                                <control-messages [control]="formHeader.get('nombre_boton')">
                                                </control-messages>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br *ngIf="formHeader.value.mostrar_boton">
                            <div class="row" *ngIf="formHeader.value.mostrar_boton">
                                <label class="label col-md-3">Url:</label>
                                <div class="col-md-9">
                                    <input type="text" placeholder="Ingrese url" nbInput fullWidth fieldSize="small" formControlName="url"
                                        >
                                    <control-messages [control]="formHeader.get('url')"></control-messages>
                                </div>
                            </div>

                            <br>
                            <div class="row">
                                <label class="label col-md-3">Contenido:</label>
                                <div class="col-md-9">
                                    <textarea type="text" placeholder="Ingrese contenido" nbInput fullWidth fieldSize="small" formControlName="contenido"
                                        ></textarea>
                                    <control-messages [control]="formHeader.get('contenido')"></control-messages>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <label class="label col-md-3">Imagen:</label>
                                <div class="col-md-9"  *ngIf="formHeader.value.imagen">
                                    <button nbButton fullWidth size="small" status="success" (click)="openPreviewFile()">{{formHeader.value.imagen}}<nb-icon icon="eye-outline"></nb-icon></button>
                                    <control-messages [control]="formHeader.get('imagen')"></control-messages>
                                </div>
                                <div class="col-md-9"  *ngIf="!formHeader.value.imagen">
                                    <button nbButton fullWidth size="small" status="basic" >Sin imágen<nb-icon icon="eye-outline"></nb-icon></button>
                                    <control-messages [control]="formHeader.get('imagen')"></control-messages>
                                </div>
                            </div>
                        </form>
                    </div>
                </nb-card>
            </div>
            <div class="col-md-7">
                <nb-card status="primary">
                    <nb-card-header style="padding-top: 5px; padding-bottom: 5px;">
                        PREPARAR IMÁGEN
                    </nb-card-header>
                    <nb-card-body>
                        <app-image-recorte
                        [paramsInfoFile]="{
                            key_file: key_file,
                            directory: directorio,
                            type: 'put'}"
                        (resultFile)="fileResult($event)"
                            ></app-image-recorte>
                    </nb-card-body>
                </nb-card>
            </div>
        </div>
    </nb-card-body>
    <nb-card-footer style="text-align: right">
        <button nbButton size="small" status="info" (click)="back()">Salir</button>&nbsp;&nbsp;
        <button nbButton size="small" status="primary" (click)="saveNews()" [disabled]="formHeader.invalid">Guardar</button>
    </nb-card-footer>
</nb-card>